{"version":3,"file":"upload.js","sources":["../src/upload/lib.js","../src/upload/config.js","../src/upload/validate.js","../src/upload/ajax.js","../src/upload/format.js","../src/upload/upload-swf.js","../src/upload/upload.js","../src/upload/upload.vue","../src/index_global.js"],"sourcesContent":["const lib = {\n    extends(source, target) {\n        for (const k in target) {\n            if (lib.isObject(target[k]) && lib.isObject(source[k])) {\n                lib.extends(source[k], target[k]);\n            } else {\n                source[k] = target[k];\n            }\n        }\n        return source;\n    },\n    clone(obj) {\n        let o;\n        if (typeof obj === 'object') {\n            if (obj === null) {\n                o = null;\n            } else if (obj instanceof Array) {\n                o = [];\n                for (let i = 0, len = obj.length; i < len; i++) {\n                    o.push(this.clone(obj[i]));\n                }\n            } else {\n                o = {};\n                for (const j in obj) {\n                    if (!lib.has(obj, j)) continue;\n                    o[j] = this.clone(obj[j]);\n                }\n            }\n        } else {\n            o = obj;\n        }\n        return o;\n    },\n    isObject(obj) {\n        return typeof obj === 'object' && !(obj instanceof Array);\n    },\n    queryString(object) {\n        const data = [];\n        let key;\n        let val;\n\n        for (key in object) {\n            // if (object.hasOwnProperty(key)) {\n            if (lib.has(object, key)) {\n                val = object[key];\n                data.push(`${key}=${encodeURIComponent(val)}`);\n            }\n        }\n        return data.join('&');\n    },\n    getRandomString(len) {\n        len = len || 32;\n        const $chars = 'ABCDEFGHJKMNPQRSTWXYZabcdefhijkmnprstwxyz2345678';\n        const maxPos = $chars.length;\n        let pwd = '';\n        for (let i = 0; i < len; i++) {\n            pwd += $chars.charAt(Math.floor(Math.random() * maxPos));\n        }\n        return pwd;\n    },\n    getWidth(dom) {\n        return dom.offsetWidth;\n    },\n    getHeight(dom) {\n        return dom.offsetHeight;\n    },\n    prepend(dom, html) {\n        dom.innerHTML = html + dom.innerHTML;\n    },\n    css(dom, sty, newSty) {\n        if (!newSty) {\n            return dom.style[sty];\n        }\n        dom.style[sty] = newSty;\n        return dom;\n    },\n    fnLoadScript: (src, fun) => {\n        const head = document.getElementsByTagName('head')[0] || document.head || document.documentElement;\n\n        const script = document.createElement('script');\n        script.setAttribute('type', 'text/javascript');\n        script.setAttribute('charset', 'UTF-8');\n        script.setAttribute('src', src);\n\n        if (typeof fun === 'function') {\n            if (window.attachEvent) {\n                script.onreadystatechange = () => {\n                    const r = script.readyState;\n                    if (r === 'loaded' || r === 'complete') {\n                        script.onreadystatechange = null;\n                        fun();\n                    }\n                };\n            } else {\n                script.onload = fun;\n            }\n        }\n\n        head.appendChild(script);\n    },\n    isImg() {\n        return true;\n    },\n    has(obj, key) {\n        return {}.hasOwnProperty.call(obj, key);\n    },\n};\n\nexport default lib;\n","const noop = () => {};\n\nexport const config = {\n    uploadUrl: '',\n    min: 0,\n    max: null,\n    method: 'POST',\n    type: '*',\n    isMultiple: false,\n    fileName: 'file',\n    beforeUpload: noop,\n    fn: noop,\n    progress: noop,\n    resBase: '//t.focus-res.cn/front-end/upload/',\n    size: {\n        minWid: null,\n        minHei: null,\n        maxWid: null,\n        maxHei: null,\n        validate: null,\n    },\n    forceFlash: false,\n};\n\nexport const setConfig = (obj) => {\n    Object.assign(config, obj);\n};\n","// 返回true 代表合法 false代表不合法\n// 校验conf是否合法\n// 通过call传递this 不能使用箭头函数\nexport const validateConf = function validateConf() {\n    if (!this.conf.uploadUrl || !this.conf.selecter || !this.conf.fn) {\n        return false;\n    }\n\n    return true;\n};\n// 校验类型\nexport const validateType = function validateType(type) {\n    if (this.conf.type === '*') {\n        return true;\n    }\n\n    return !!(this.conf.type.indexOf(type) !== -1);\n};\n// 校验尺寸\nexport const validateSize = function validateSize(size) {\n    return (!this.conf.min || size >= this.conf.min) && (!this.conf.max || size <= this.conf.max);\n};\n// 校验文件大小\nexport const validateCap = function validateCap(img, conf) {\n    return new Promise((resolve, reject) => {\n        const val = (img) => {\n            const width = img.width;\n            const height = img.height;\n            const size = conf.size;\n            if ((size.minWid && width < size.minWid) ||\n                (size.maxWid && width > size.maxWid) ||\n                (size.minHei && height < size.minHei) ||\n                (size.maxHei && height > size.maxHei)\n            ) {\n                /* eslint-disable prefer-promise-reject-errors */\n                reject({\n                    error: '图片尺寸不符合要求!',\n                });\n                /* eslint-disable prefer-promise-reject-errors */\n            } else {\n                resolve();\n            }\n        };\n        if (img.complete) {\n            return val(img);\n        }\n        img.onload = () => val(img);\n\n        return true;\n    });\n};\n","const lint = (conf) => {\n    const lintFile = {};\n    if (conf.url) {\n        lintFile.error = '缺少参数url';\n    }\n    return lintFile;\n};\n\nexport default (conf) => {\n    const lintFile = lint(conf);\n    const xhr = new XMLHttpRequest();\n    if (lint.error && conf.fn && typeof conf.fn === 'function') {\n        conf.fn(lintFile);\n        return;\n    }\n    if (xhr.upload) {\n        if (conf.progress && typeof conf.progress === 'function') {\n            (function progress(conf) {\n                xhr.upload.onprogress = (event) => {\n                    if (event.lengthComputable) {\n                        const percentComplete = event.loaded / event.total;\n                        conf.progress(conf.file, percentComplete);\n                    }\n                };\n            }(conf));\n        }\n\n\n        // 开始上传\n        xhr.open(conf.method, conf.uploadUrl, true);\n        xhr.setRequestHeader('Accept', '*/*');\n        xhr.withCredentials = conf.credentials;\n        xhr.onreadystatechange = () => {\n            if (xhr.readyState === 4) {\n                if (xhr.status === 200) {\n                    if (typeof conf.fn === 'function') conf.fn(JSON.parse(xhr.response), conf.file);\n                } else {\n                    conf.fn({\n                        error: `上传失败${xhr.responseText}`,\n                    });\n                }\n            }\n        };\n        xhr.send(conf.data);\n    }\n};\n","export default {\n    typeFormat(typeArray) {\n        if (typeArray === '*') return '*';\n        if (!typeArray || !typeArray.length) return '';\n        typeArray.forEach((item, index) => {\n            typeArray[index] = `*.${item}`;\n        });\n        return typeArray.join(';');\n    },\n    sizeFormat(size) {\n        if (!size || !parseFloat(size, 10)) return '0B';\n        let unit = 'B';\n        const hihgUnit = (unit) => {\n            let unitUp = 'B';\n            switch (unit) {\n            case 'B':\n                unitUp = 'KB';\n                break;\n            case 'KB':\n                unitUp = 'MB';\n                break;\n            case 'MB':\n                unitUp = 'GB';\n                break;\n            case 'GB':\n                unitUp = 'TB';\n                break;\n            default:\n                break;\n            }\n            return unitUp;\n        };\n        let sizes = parseInt(size, 10);\n        while (sizes > 1024) {\n            unit = hihgUnit(unit);\n            sizes = parseFloat(sizes / 1024, 10);\n        }\n\n        return `${sizes} ${unit}`;\n    },\n};\n","import lib from './lib';\nimport format from './format';\nimport { config } from './config';\nimport { validateCap } from './validate';\n\nlet loading = false;\nlet initList = [];\n// const SWFUpload = window.SWFUpload;\n\nconst setting = {\n    prevent_swf_caching: false,\n    file_size_limit: '1 MB',\n    file_post_name: 'file',\n    file_types: '*.jpg;*.png;*.gif;*.jpeg',\n    button_text: '',\n};\n\nconst fnInit = ($dom, conf) => {\n    const height = lib.getHeight($dom);\n    const width = lib.getWidth($dom);\n    const SWFUpload = window.SWFUpload;\n\n    const _setting = lib.extends(setting, {\n        flash_url: `${config.resBase}swfupload.swf`,\n        button_image_url: `${config.resBase}swfupload.js?button_image_url`,\n        upload_url: conf.uploadUrl,\n        button_placeholder_id: conf.id,\n        button_width: width,\n        button_height: height,\n        button_cursor: SWFUpload.CURSOR.HAND,\n        button_window_mode: SWFUpload.WINDOW_MODE.TRANSPARENT,\n        conf,\n        upload_start_handler() {\n            this.settings.conf.beforeUpload();\n        },\n        file_dialog_complete_handler() {\n            this.startUpload();\n        },\n        file_queue_error_handler(a, b, c) {\n            this.settings.conf.fn(b, c);\n        },\n        // upload_success_handler(a, b, c) {\n        upload_success_handler(a, b) {\n            this.settings.conf.fn(b, a);\n        },\n    });\n\n    /* eslint-disable no-new */\n    new SWFUpload(lib.clone(_setting));\n    /* eslint-disable no-new */\n};\nconst uploader = {\n    create($dom, conf) {\n        if (window.SWFUpload) {\n            fnInit($dom, conf);\n        } else {\n            initList.push([$dom, conf]);\n\n            if (loading) {\n                return;\n            }\n\n            loading = true;\n            lib.fnLoadScript(`${config.resBase}swfupload.js`, () => {\n                loading = false;\n\n                let i;\n                let item;\n                for (i = 0; i < initList.length; i++) {\n                    item = initList[i];\n                    fnInit(item[0], item[1]);\n                }\n                initList = [];\n            });\n        }\n    },\n    config(paramsConfig) {\n        lib.extends(setting, paramsConfig);\n    },\n};\n\nfunction upload(dom, conf) {\n    if (dom) {\n        uploader.config({\n            // file_size_limit: format.sizeFormat(conf.max),\n            file_size_limit: `${conf.max}B`,\n            file_post_name: conf.fileName,\n            file_types: format.typeFormat(conf.type),\n            upload_progress_handler: conf.progress,\n            button_placeholder_id: 'selectFiles4',\n        });\n        const fn = conf.fn;\n        conf.fn = function finish(response, file) {\n            // 校验大小\n            if (typeof response === 'string') {\n                response = JSON.parse(response);\n            }\n            if (response === -110) {\n                response = {\n                    error: '图片大小不符合要求',\n                };\n            }\n            if (!lib.has(response, 'error') && conf.size && conf.size.validate && lib.isImg()) {\n                validateCap.call(null, conf.size.validate(response), conf)\n                    .then(() => {\n                        fn.call(this, response, file);\n                    }, (error) => {\n                        fn.call(this, error);\n                    });\n            } else {\n                fn.call(this, response, file);\n            }\n        };\n        uploader.create(dom, conf);\n    }\n}\nexport default upload;\n","import lib from './lib';\nimport { config } from './config';\nimport { validateSize, validateType, validateCap } from './validate';\nimport ajax from './ajax';\nimport uploadSwf from './upload-swf';\n\nconst lint = (file) => {\n    const result = {\n        error: '',\n        errorType: 0,\n    };\n    const type = file.name.split('.').pop().toLowerCase();\n    result.type = type;\n    result.name = `${lib.getRandomString(32)}.${type}`;\n\n    if (!validateSize.call(this, file.size)) {\n        result.error = '图片大小不符合要求!';\n        result.errorType = 1;\n    }\n\n    if (!validateType.call(this, type)) {\n        result.error = '图片类型错误!';\n        result.errorType = result.errorType ? 3 : 2;\n        return result;\n    }\n\n    return result;\n};\n\nconst uploadAjax = (file, name, conf) => {\n    const formData = new FormData();\n    // const uploadData = {\n    //    name: conf.fileName,\n    //    file,\n    // };\n    conf.file = file;\n    formData.append(conf.fileName, file);\n    conf.data = formData;\n    ajax(conf);\n};\n\nexport default {\n    name: 'upload',\n    props: {\n        config: {\n            type: Object,\n        },\n    },\n    data() {\n        return {\n            isHtml5: true,\n            conf: {},\n            id: 0,\n        };\n    },\n    beforeMount() {\n        this.extendConf();\n        this.isHtml5 = !!(window.File) && !config.forceFlash;\n        this.conf.id = `id-${+new Date()}`;\n    },\n    watch: {\n        config() {\n            this.extendConf();\n        },\n    },\n    computed: {\n        multiple() {\n            return config.isMultiple;\n        },\n    },\n    mounted() {\n        const parent = this.$el.parentElement;\n\n        if (lib.css(parent, 'position') === 'static' || lib.css(parent, 'position') === '') {\n            lib.css(parent, 'position', 'relative');\n        }\n\n        if (!this.isHtml5) {\n            uploadSwf(this.$el, this.conf);\n        }\n    },\n    methods: {\n        extendConf() {\n            const globalConf = Object.assign({}, config);\n            this.conf = Object.assign(globalConf, this.config);\n        },\n        upload(e) {\n            const file = e.target.files;\n            let i;\n            let item;\n            const errors = [];\n            let error = '';\n\n            for (i = 0; i < file.length; i++) {\n                item = file[i];\n                errors[i] = lint.call(this, item).errorType;\n            }\n            if (errors.indexOf(1) !== -1 || errors.indexOf(3) !== -1) {\n                error += '图片大小不符合要求';\n            }\n            if (errors.indexOf(2) !== -1 || errors.indexOf(3) !== -1) {\n                if (error) error += '、';\n                error += '图片格式不符合要求';\n            }\n            if (error) {\n                this.conf.fn({ error });\n                return;\n            }\n            for (i = 0; i < file.length; i++) {\n                item = file[i];\n                const lintFile = lint.call(this, item);\n                // hack onchange\n                {\n                    const success = this.conf.fn;\n                    this.conf.fn = (res, file) => {\n                        this.$refs['upload-btn'].value = '';\n                        if (this.conf.size && this.conf.size.validate && lib.isImg()) {\n                            validateCap.call(null, this.conf.size.validate(res), this.conf)\n                                .then(() => {\n                                    success.call(this, res, file);\n                                }, (error) => {\n                                    success.call(this, error);\n                                });\n                        } else {\n                            success.call(this, res, file);\n                        }\n                    };\n                }\n                if (typeof this.conf.beforeUpload === 'function') this.conf.beforeUpload(item);\n                uploadAjax(item, lintFile.name, Object.assign({}, this.conf));\n            }\n        },\n    },\n};\n","<template lang=\"pug\">\n    div.upload-html(v-if=\"isHtml5\")\n        input.upload-btn(ref=\"upload-btn\" type=\"file\" :multiple=\"multiple\" @change=\"upload\")\n    div.upload-swf(v-else)\n        span.upload-btn-id(:id=\"conf.id\")\n</template>\n<style scoped>\n    .upload-html {\n        width: 100%;\n        height: 100%;\n        position: absolute;\n        top: 0;\n        left: 0;\n        font-size: 0;\n    }\n    .upload-html .upload-btn {\n        width: 100%;\n        height: 100%;\n        opacity: 0;\n        filter: alpha(opacity=0);\n        cursor: pointer;\n        z-index: 100;\n    }\n    .upload-swf {\n        width: 100%;\n        height: 100%;\n        position: absolute;\n        top: 0;\n        left: 0;\n        overflow: hidden;\n        opacity: 0;\n        filter: alpha(opacity=0);\n        z-index: 100;\n    }\n</style>\n<script src=\"./upload.js\">\n</script>\n","import app from './upload/upload.vue';\nimport { setConfig } from './upload/config';\n\nconst install = (Vue, config, name = '') => {\n    setConfig(config);\n    Vue.component(name || app.name, app);\n};\n\n/* istanbul ignore if */\nif (typeof window !== 'undefined' && window.Vue) {\n    install(window.Vue);\n}\n\nmodule.exports = {\n    install,\n};\n"],"names":["lib","source","target","k","isObject","extends","obj","o","Array","i","len","length","push","clone","j","has","object","data","key","val","encodeURIComponent","join","$chars","maxPos","pwd","charAt","Math","floor","random","dom","offsetWidth","offsetHeight","html","innerHTML","sty","newSty","style","src","fun","head","document","getElementsByTagName","documentElement","script","createElement","setAttribute","window","attachEvent","onreadystatechange","r","readyState","onload","appendChild","hasOwnProperty","call","noop","config","setConfig","assign","validateType","type","conf","indexOf","validateSize","size","min","max","validateCap","img","Promise","resolve","reject","width","height","minWid","maxWid","minHei","maxHei","complete","lint","lintFile","url","error","xhr","XMLHttpRequest","fn","upload","progress","onprogress","event","lengthComputable","percentComplete","loaded","total","file","open","method","uploadUrl","setRequestHeader","withCredentials","credentials","status","JSON","parse","response","responseText","send","typeArray","forEach","item","index","parseFloat","unit","hihgUnit","unitUp","sizes","parseInt","loading","initList","setting","fnInit","$dom","getHeight","getWidth","SWFUpload","_setting","resBase","id","CURSOR","HAND","WINDOW_MODE","TRANSPARENT","settings","beforeUpload","startUpload","a","b","c","uploader","fnLoadScript","paramsConfig","fileName","format","typeFormat","finish","validate","isImg","then","create","result","name","split","pop","toLowerCase","getRandomString","errorType","uploadAjax","formData","FormData","append","Object","extendConf","isHtml5","File","forceFlash","Date","isMultiple","parent","$el","parentElement","css","globalConf","e","files","errors","success","res","$refs","value","install","Vue","component","app","module","exports"],"mappings":"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"}